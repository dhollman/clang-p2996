Plan for implementing P3294
===========================

Broad Outline of the Current Plan
---------------------------------

Here's what Dan Katz's emailed me to get me started:

- New `APValue` representation for "a reflection of a token sequence"
- New `Expr` node representing the `^{ ... }` sequence (which evaluates to `std::meta::info`, or possibly a new type `std::meta::token_sequence`, depending on what the authors decide)
- New `Expr` nodes for the interpolators (`\id`, `\(...)`, and `\tokens`)
- `TreeTransform` logic for template substitution of `TokenSequenceExpr`'s
- `ExprConstant` logic for evaluating a `TokenSequenceExpr` to its reflection value
- A bunch of annoying little things like inventing a mangling for a template substituted with a reflection of a token sequence

The `queue_injection` metafunction will need a bit of scaffolding---I thought we might build a parallel analogue to the existing "Metafunction" machinery for a "Tokenfunction".
- Add a `__tokenfunction` intrinsic.
- Introduce a new `TokenAction` interface that exposes a "limited view" of the Parser to evaluation.
- Implement a `TokenActionImpl` implementation of `TokenAction`, which is constructed with a reference to the Parser.
- Plum `TokenActionImpl` into Sema, and from there into `CXXTokenFunctionExpr`.
- `TreeTransform` logic for template substitution of `CXXTokenfunctionExpr`.
- `ExprConstant` logic for evaluating a `CXXTokenFunctionExpr`.

That leaves the implementation of the actual "injection". Since the tokens injected by a `queue_injection` call must constitute a valid statement or declaration, the parser will need to know where an injection begins and ends.
- Introduce new "marker tokens" indicating the start and end of an injection.
- Teach the parser to handle the new "marker tokens" (i.e., ill-formed everywhere they aren't "expected").
- Add a method to the `TokenAction` interface to inject a sequence of tokens.
- Implement the method in `TokenActionImpl` to do the token injection (probably through `Preprocessor::EnterTokenStream`).

Where do we start?
------------------

- Let's start with the `APValue` part and see if we can get that compiling, and then maybe write some tests.
  - We want to try and get an `ast-dump` test working.
  - Let's start with writing one for reflection
  - We'll need to write something analogous to the `PropertyTypeCase` starting in `clang/include/clang/AST/PropertiesBase.td` line 435 
  - Implement `ParseCXXTokenSequenceExpression` in `ParseReflect.cpp`
- Then the `Expr` nodes, and get it compiling again. And also maybe tests?
  - We need to implement something analogous to `ActOnCXXReflectExpr` in `SemaReflect.cpp`
  - We need to implement something analogous to `BuildCXXReflectExpr` in `SemaReflect.cpp`
  - We need to implement something analogous to `CXXReflectExpr` in `ExprCXX.h`
  - computeDependence overload

What have we done?
------------------

- Added `TokenSequence` to `APValue::ValueKind`

Important Files and Lines
-------------------------